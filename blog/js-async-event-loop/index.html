
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBaoHG Blog - Lập trình mạng, Java & JavaScript</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        brand: {
                            light: '#f0f9ff',
                            DEFAULT: '#0ea5e9',
                            dark: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .prose pre {
            background-color: #1e293b;
            color: #f8fafc;
            padding: 1.25rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            margin: 1.5rem 0;
        }
        .prose h2 {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-top: 2.5rem;
        }
        .dark .prose h2 {
            border-bottom-color: #1e293b;
        }
    </style>

<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.11.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
  <script type="module" crossorigin src="/BlogCaNhan/assets/index-BFAWYazd.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 min-h-screen">
    <div id="root"><div class="flex flex-col min-h-screen"><nav class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800"><div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between h-16 items-center"><a class="flex items-center gap-2 text-xl font-bold text-brand dark:text-brand-light" href="/BlogCaNhan/" data-discover="true"><span class="tracking-tight">BBaoHG</span></a><div class="hidden md:flex items-center space-x-8"><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/BlogCaNhan/" data-discover="true">Home</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/BlogCaNhan/blog" data-discover="true">Blog</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/BlogCaNhan/certificates" data-discover="true">Certificates</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/BlogCaNhan/about" data-discover="true">About</a><button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" aria-label="Toggle Dark Mode"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" aria-hidden="true"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path></svg></button></div><div class="md:hidden flex items-center gap-4"><button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" aria-hidden="true"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path></svg></button><button class="text-slate-600 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu" aria-hidden="true"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg></button></div></div></div></nav><main class="flex-grow"><div style="opacity:0;transform:translateY(20px)"><div class="max-w-4xl mx-auto px-4 py-12"><a class="inline-flex items-center gap-2 text-slate-500 hover:text-brand mb-8 transition-colors" href="/BlogCaNhan/blog" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg> Quay lại danh sách</a><article><header class="mb-10 space-y-4"><div class="flex items-center gap-3 text-sm font-medium"><span class="px-3 py-1 bg-brand/10 text-brand rounded-full">JavaScript</span><div class="flex items-center gap-1 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar" aria-hidden="true"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg> <span>2024-03-25</span></div><div class="flex items-center gap-1 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock" aria-hidden="true"><path d="M12 6v6l4 2"></path><circle cx="12" cy="12" r="10"></circle></svg> <span>25 phút<!-- --> đọc</span></div></div><h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Giải mã Event Loop: Tại sao JavaScript nhanh dù chỉ có đơn luồng?</h1></header><div class="prose prose-slate dark:prose-invert max-w-none prose-lg"><h1 class="text-3xl font-bold mt-8 mb-4">Giải mã Event Loop trong JavaScript</h1>
<p>JavaScript nổi tiếng là ngôn ngữ đơn luồng (Single-threaded). Vậy tại sao nó lại được dùng để xây dựng các hệ thống backend cực nhanh như Node.js? Câu trả lời nằm ở <strong>Event Loop</strong>.</p>
<p>Thay vì tạo hàng nghìn thread như trong nhiều ngôn ngữ khác, JavaScript tận dụng cơ chế non-blocking I/O và hàng đợi sự kiện để mô phỏng khả năng xử lý đồng thời trên một luồng duy nhất.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">1. Cấu trúc bộ nhớ</h2>
<ul class="list-disc pl-5 mb-4 space-y-1">
<li class="pl-1"><strong>Call Stack:</strong> Nơi lưu trữ các hàm đang thực thi. Theo cơ chế LIFO (Last In First Out).</li>
<li class="pl-1"><strong>Web APIs:</strong> Được trình duyệt (hoặc C++ APIs trong Node) cung cấp để xử lý các tác vụ như <code>setTimeout</code>, <code>fetch</code>, DOM events.</li>
<li class="pl-1"><strong>Task Queue (Macrotasks):</strong> Chứa các callback từ <code>setTimeout</code>, <code>setInterval</code>.</li>
<li class="pl-1"><strong>Microtask Queue:</strong> Ưu tiên cao hơn Macrotasks. Chứa các callback từ <code>Promise.then</code>, <code>process.nextTick</code>.</li>
</ul>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">2. Quy trình của Event Loop</h2>
<ol class="list-decimal pl-5 mb-4 space-y-1">
<li class="pl-1">Kiểm tra Call Stack. Nếu trống, chuyển sang bước 2.</li>
<li class="pl-1">Kiểm tra Microtask Queue. Thực thi <strong>tất cả</strong> các task có trong hàng đợi này.</li>
<li class="pl-1">Kiểm tra Macrotask Queue. Thực thi <strong>một</strong> task, sau đó quay lại bước 1.</li>
</ol>
<p>Điểm quan trọng: <strong>Microtask luôn được ưu tiên hơn Macrotask</strong>. Điều này giải thích nhiều “câu đố” liên quan đến thứ tự log khi kết hợp Promise và setTimeout.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">3. Ví dụ kinh điển</h2>
<p>Bạn đoán xem kết quả sẽ là gì?</p>
<pre><code class="language-javascript">console.log(&#x27;1&#x27;);

setTimeout(() =&gt; console.log(&#x27;2&#x27;), 0);

Promise.resolve().then(() =&gt; console.log(&#x27;3&#x27;));

console.log(&#x27;4&#x27;);
</code></pre>
<p>Kết quả là: <code>1, 4, 3, 2</code>. Tại sao? Vì <code>Promise</code> vào Microtask Queue, còn <code>setTimeout</code> vào Macrotask Queue.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">4. Ứng dụng thực tế trong UI và backend</h2>
<p>Khi làm việc với các tác vụ nặng (như xử lý ảnh), nếu bạn chạy nó trực tiếp trên main thread, giao diện sẽ bị &quot;đơ&quot;. Hiểu Event Loop giúp bạn biết cách tách các tác vụ này ra (sử dụng Web Workers hoặc chia nhỏ tác vụ với <code>setImmediate</code>).</p>
<p>Trong frontend, bạn có thể chia nhỏ một vòng lặp lớn thành nhiều batch nhỏ và dùng <code>setTimeout(..., 0)</code> hoặc <code>requestIdleCallback</code> để nhường quyền chạy cho browser giữa các batch, tránh chặn render.</p>
<p>Trong Node.js, việc hiểu rõ Event Loop giúp bạn:</p>
<ul class="list-disc pl-5 mb-4 space-y-1">
<li class="pl-1">Không block thread bằng các hàm sync như <code>fs.readFileSync</code> trong luồng xử lý request.</li>
<li class="pl-1">Thiết kế API không bị “callback hell” bằng cách dùng Promise/async-await nhưng vẫn tôn trọng bản chất async.</li>
</ul>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">5. Một ví dụ phức tạp hơn</h2>
<p>Hãy xem đoạn code sau và tự suy nghĩ thứ tự log:</p>
<pre><code class="language-javascript">console.log(&#x27;A&#x27;);

setTimeout(() =&gt; {
  console.log(&#x27;B&#x27;);
}, 0);

Promise.resolve()
  .then(() =&gt; {
    console.log(&#x27;C&#x27;);
    return Promise.resolve();
  })
  .then(() =&gt; {
    console.log(&#x27;D&#x27;);
  });

console.log(&#x27;E&#x27;);
</code></pre>
<p>Thứ tự đúng là: <code>A, E, C, D, B</code>. Hai <code>then</code> liên tiếp vẫn nằm trong Microtask Queue và được chạy liền nhau trước khi Event Loop quay lại xử lý Macrotask.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">6. Kết nối với performance thực tế</h2>
<p>Khi debug performance, bạn sẽ thấy trong Performance tab của DevTools có các phase như &quot;scripting&quot;, &quot;rendering&quot;, &quot;painting&quot;. Rất nhiều vấn đề không nằm ở chỗ &quot;JS chậm&quot; mà là do ta <strong>block event loop</strong> quá lâu.</p>
<ul class="list-disc pl-5 mb-4 space-y-1">
<li class="pl-1">Tránh vòng lặp nặng trong 1 tick.</li>
<li class="pl-1">Ưu tiên I/O async.</li>
<li class="pl-1">Tận dụng Web Worker khi xử lý CPU bound (ví dụ: encode video, xử lý ảnh).</li>
</ul>
<hr/>
<p>Nắm chắc Event Loop là bước ngoặt để từ một coder trở thành một Engineer thực thụ, biết cách đọc stack trace, hiểu timeline và tối ưu ứng dụng trên cả frontend lẫn backend.</p></div></article><div class="mt-16 pt-8 border-t border-slate-200 dark:border-slate-800 flex flex-col md:flex-row justify-between gap-6"><a class="flex flex-col p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl hover:border-brand transition-all flex-1 text-left group" href="/BlogCaNhan/blog/java-multithreading-basics" data-discover="true"><span class="text-xs text-slate-500 mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left" aria-hidden="true"><path d="m15 18-6-6 6-6"></path></svg> Bài trước</span><span class="font-semibold group-hover:text-brand transition-colors line-clamp-1">Multithreading trong Java: Từ Thread cơ bản đến ExecutorService</span></a><a class="flex flex-col p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl hover:border-brand transition-all flex-1 text-right group" href="/BlogCaNhan/blog/java-socket-programming-intro" data-discover="true"><span class="text-xs text-slate-500 mb-1 flex items-center justify-end gap-1">Bài tiếp theo <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></span><span class="font-semibold group-hover:text-brand transition-colors line-clamp-1">Lập trình Socket trong Java: Xây dựng TCP server &amp; client đơn giản</span></a></div></div></div></main><footer class="py-12 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950"><div class="max-w-6xl mx-auto px-4 text-center space-y-4"><p class="text-slate-500 text-sm font-medium">© <!-- -->2025<!-- --> BBaoHG Blog. Crafting knowledge for the network age.</p></div></footer></div></div>
</body>
</html>
