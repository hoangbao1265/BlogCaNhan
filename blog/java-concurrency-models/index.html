
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBaoHG Blog - Lập trình mạng, Java & JavaScript</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        brand: {
                            light: '#f0f9ff',
                            DEFAULT: '#0ea5e9',
                            dark: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .prose pre {
            background-color: #1e293b;
            color: #f8fafc;
            padding: 1.25rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            margin: 1.5rem 0;
        }
        .prose h2 {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-top: 2.5rem;
        }
        .dark .prose h2 {
            border-bottom-color: #1e293b;
        }
    </style>

<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.11.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
  <script type="module" crossorigin src="/BlogCaNhan/assets/index-q1bugERU.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 min-h-screen">
    <div id="root"><div class="flex flex-col min-h-screen"><nav class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800"><div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between h-16 items-center"><a class="flex items-center gap-2 text-xl font-bold text-brand dark:text-brand-light" href="/" data-discover="true"><span class="tracking-tight">BBaoHG</span></a><div class="hidden md:flex items-center space-x-8"><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/" data-discover="true">Home</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/blog" data-discover="true">Blog</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/certificates" data-discover="true">Certificates</a><a class="text-sm font-medium transition-colors hover:text-brand text-slate-600 dark:text-slate-400" href="/about" data-discover="true">About</a><button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" aria-label="Toggle Dark Mode"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" aria-hidden="true"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path></svg></button></div><div class="md:hidden flex items-center gap-4"><button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" aria-hidden="true"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path></svg></button><button class="text-slate-600 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu" aria-hidden="true"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg></button></div></div></div></nav><main class="flex-grow"><div style="opacity:0;transform:translateY(20px)"><div class="max-w-4xl mx-auto px-4 py-12"><a class="inline-flex items-center gap-2 text-slate-500 hover:text-brand mb-8 transition-colors" href="/blog" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg> Quay lại danh sách</a><article><header class="mb-10 space-y-4"><div class="flex items-center gap-3 text-sm font-medium"><span class="px-3 py-1 bg-brand/10 text-brand rounded-full">Java</span><div class="flex items-center gap-1 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar" aria-hidden="true"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg> <span>2024-04-05</span></div><div class="flex items-center gap-1 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock" aria-hidden="true"><path d="M12 6v6l4 2"></path><circle cx="12" cy="12" r="10"></circle></svg> <span>30 phút<!-- --> đọc</span></div></div><h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Concurrency trong Java: Từ Thread truyền thống đến Virtual Threads</h1></header><div class="prose prose-slate dark:prose-invert max-w-none prose-lg"><h1 class="text-3xl font-bold mt-8 mb-4">Concurrency trong Java: Sự tiến hóa</h1>
<p>Xử lý đa luồng luôn là một trong những phần khó nhất nhưng cũng thú vị nhất của Java. Nếu không nắm rõ mô hình concurrency, bạn rất dễ tạo ra những bug “ma” khó reproduce, hoặc lãng phí tài nguyên máy chủ.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">1. Platform Threads (Truyền thống)</h2>
<p>Mỗi luồng Java tương ứng với một luồng hệ điều hành (OS Thread). Điều này rất tốn kém tài nguyên (mất khoảng 1MB bộ nhớ cho mỗi stack). Bạn không thể tạo ra 1 triệu luồng như vậy.</p>
<p>Platform Threads phù hợp với các ứng dụng desktop, hoặc server với số lượng kết nối vừa phải. Nhưng khi bước vào thế giới microservices, hàng chục nghìn kết nối đồng thời là chuyện bình thường.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">2. Thread Pool (ExecutorService)</h2>
<p>Để giải quyết vấn đề trên, chúng ta dùng Thread Pool. Tuy nhiên, nó vẫn bị giới hạn. Nếu một task phải chờ I/O (như gọi database), luồng đó sẽ bị block, gây lãng phí CPU.</p>
<p>Một ví dụ đơn giản về Thread Pool:</p>
<pre><code class="language-java">ExecutorService executor = Executors.newFixedThreadPool(10);

for (int i = 0; i &lt; 100; i++) {
    int index = i;
    executor.submit(() -&gt; {
        System.out.println(&quot;Task &quot; + index + &quot; running on &quot; + Thread.currentThread().getName());
    });
}

executor.shutdown();
</code></pre>
<p>Thread Pool phù hợp cho các tác vụ CPU bound hoặc số lượng task không quá khổng lồ. Nhưng khi bạn cần xử lý hàng chục nghìn kết nối I/O đồng thời, mô hình này bắt đầu lộ hạn chế.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">3. Virtual Threads (Java 21+)</h2>
<p>Đây là &quot;game changer&quot;. Virtual Threads cực kỳ nhẹ (chỉ tốn vài KB bộ nhớ). Khi một Virtual Thread bị block bởi I/O, Java runtime sẽ tự động ngắt nó ra khỏi OS Thread và cho task khác vào chạy.</p>
<pre><code class="language-java">try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    IntStream.range(0, 10_000).forEach(i -&gt; {
        executor.submit(() -&gt; {
            Thread.sleep(Duration.ofSeconds(1));
            return i;
        });
    });
}
</code></pre>
<p>Đoạn code trên có thể chạy 10,000 task song song chỉ trong tích tắc mà không làm &quot;treo&quot; máy.</p>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">4. Khi nào nên dùng Virtual Threads?</h2>
<ul class="list-disc pl-5 mb-4 space-y-1">
<li class="pl-1">Khi bạn xây dựng server xử lý rất nhiều request I/O bound (HTTP, database, message queue,...).</li>
<li class="pl-1">Khi bạn muốn giữ style code đồng bộ (blocking) nhưng vẫn đạt hiệu năng như async non-blocking.</li>
<li class="pl-1">Khi bạn đang migrate từ code multi-threading cũ sang mô hình mới mà không muốn viết lại toàn bộ theo phong cách reactive.</li>
</ul>
<h2 class="text-2xl font-bold mt-8 mb-4 border-b border-slate-200 dark:border-slate-800 pb-2">5. Kết nối với kiến trúc tổng thể</h2>
<p>Virtual Threads không thay thế mọi thứ, nhưng nó mở ra cách tiếp cận mới:</p>
<ul class="list-disc pl-5 mb-4 space-y-1">
<li class="pl-1">Dùng Virtual Threads cho tầng service / controller.</li>
<li class="pl-1">Dùng thread pool/bare threads cho các tác vụ cần kiểm soát chặt tài nguyên.</li>
<li class="pl-1">Kết hợp với structured concurrency để quản lý vòng đời task rõ ràng hơn.</li>
</ul>
<hr/>
<p>Kỷ nguyên mới của Java đã đến, nơi chúng ta có thể viết mã đồng bộ nhưng thực thi bất đồng bộ một cách cực kỳ hiệu quả. Hiểu rõ các mô hình concurrency giúp bạn chọn đúng công cụ cho từng bài toán và khai thác tối đa sức mạnh của JVM.</p></div></article><div class="mt-16 pt-8 border-t border-slate-200 dark:border-slate-800 flex flex-col md:flex-row justify-between gap-6"><a class="flex flex-col p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl hover:border-brand transition-all flex-1 text-left group" href="/blog/network-tcp-deep-dive" data-discover="true"><span class="text-xs text-slate-500 mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left" aria-hidden="true"><path d="m15 18-6-6 6-6"></path></svg> Bài trước</span><span class="font-semibold group-hover:text-brand transition-colors line-clamp-1">TCP Handshake và bài toán tối ưu hóa độ trễ mạng</span></a><div class="flex-1"></div></div></div></div></main><footer class="py-12 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950"><div class="max-w-6xl mx-auto px-4 text-center space-y-4"><p class="text-slate-500 text-sm font-medium">© <!-- -->2025<!-- --> BBaoHG Blog. Crafting knowledge for the network age.</p></div></footer></div></div>
</body>
</html>
